#!/bin/sh

TEMP=`getopt -o d46tus --long debug,ipv4,ipv6,tcp,udp,sctp -- $@`

if [ $? != 0 ] ; 
    then echo "Terminating..." >&2 ; exit 1 ; fi

# Note the quotes around `$TEMP': they are essential!
eval set -- "$TEMP"

echo -n "OPT=" >makefile
while true ; do
        case "$1" in
                -d|--debug)
                    echo "With debug info"
                    echo -n " -g -DDEBUG" >>makefile
                    shift
                    ;;
                -4|--ipv4)
                    echo "With ipv4 support"
                    echo -n " -DUSEIP4" >>makefile
                    shift
                    ;;
                -6|--ipv6)
                    echo "With ipv6 support"
                    echo -n " -DUSEIP6" >>makefile
                    shift
                    ;;
                -t|--tcp)
                    echo "With tcp support"
                    echo -n " -DUSETCP" >>makefile
                    shift
                    ;;
                -u|--udp)
                    echo "With udp support"
                    echo -n " -DUSEUDP" >>makefile
                    shift
                    ;;
                -s|--sctp)
                    echo "With sctp support"
                    echo -n " -DUSESCTP" >>makefile
                    shift
                    ;;
                --)
                    break
                    ;;
                *)
                    echo "Internal error!"
                    echo "$1"
                    exit 1
                    ;;
        esac
done

echo "" >>makefile
cat makefile.def >>makefile
